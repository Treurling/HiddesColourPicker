/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(r){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(r)}function r(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function t(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach(function(r){n(e,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}function n(r,t,n){return(t=function(r){var t=function(r){if("object"!=e(r)||!r)return r;var t=r[Symbol.toPrimitive];if(void 0!==t){var n=t.call(r,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(r);return"symbol"==e(t)?t:t+""}(t))in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function o(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function i(t,n,o,a){var i=n&&n.prototype instanceof s?n:s,l=Object.create(i.prototype);return c(l,"_invoke",function(t,n,o){var c,a,i,s=0,l=o||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(r,t){return c=r,a=0,i=e,p.n=t,u}};function f(t,n){for(a=t,i=n,r=0;!d&&s&&!o&&r<l.length;r++){var o,c=l[r],f=p.p,v=c[2];t>3?(o=v===n)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=e):c[0]<=f&&((o=t<2&&f<c[1])?(a=0,p.v=n,p.n=c[1]):f<v&&(o=t<3||c[0]>n||n>v)&&(c[4]=t,c[5]=n,p.n=v,a=0))}if(o||t>1)return u;throw d=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),a=l,i=v;(r=a<2?e:i)||!d;){c||(a?a<3?(a>1&&(p.n=-1),f(a,i)):p.n=i:p.v=i);try{if(s=2,c){if(a||(o="next"),r=c[o]){if(!(r=r.call(c,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=c.return)&&r.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=e}else if((r=(d=p.n<0)?i:t.call(n,p))!==u)break}catch(r){c=e,a=1,i=r}finally{s=1}}return{value:r,done:d}}}(t,o,a),!0),l}var u={};function s(){}function l(){}function d(){}r=Object.getPrototypeOf;var p=[][n]?r(r([][n]())):(c(r={},n,function(){return this}),r),f=d.prototype=s.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,c(f,"constructor",d),c(d,"constructor",l),l.displayName="GeneratorFunction",c(d,a,"GeneratorFunction"),c(f),c(f,a,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:v}})()}function c(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,r,t,n){function a(r,t){c(e,r,function(e){return this._invoke(r,t,e)})}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(a("next",0),a("throw",1),a("return",2))},c(e,r,t,n)}function a(e,r,t,n,o,c,a){try{var i=e[c](a),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function i(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var c=e.apply(r,t);function i(e){a(c,n,o,i,u,"next",e)}function u(e){a(c,n,o,i,u,"throw",e)}i(void 0)})}}function u(e,r,t){return"#"+((1<<24)+(e<<16)+(r<<8)+t).toString(16).slice(1)}function s(e){var r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);return r?{r:parseInt(r[1]),g:parseInt(r[2]),b:parseInt(r[3]),a:255,hex:u(parseInt(r[1]),parseInt(r[2]),parseInt(r[3])),rgb:e}:null}function l(e,r,t,n){return{r:e,g:r,b:t,a:n,hex:u(e,r,t),rgb:"rgb(".concat(e,", ").concat(r,", ").concat(t,")")}}function d(e){return l(Math.min(Math.round(1.2*e.r),255),Math.min(Math.round(1.2*e.g),255),Math.min(Math.round(1.2*e.b),255),e.a)}function p(e){return l(Math.max(Math.round(.8*e.r),0),Math.max(Math.round(.8*e.g),0),Math.max(Math.round(.8*e.b),0),e.a)}function f(){return(f=i(o().m(function e(r,t,n){var c,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r){e.n=1;break}return n({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.p=1,e.n=2,browser.tabs.captureVisibleTab(null,{format:"png",quality:100});case 2:c=e.v,(a=new Image).onload=function(){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=a.width,e.height=a.height,r.drawImage(a,0,0);var o=r.getImageData(t.x,t.y,1,1).data,c=l(o[0],o[1],o[2],o[3]);n({success:!0,data:c})},a.onerror=function(){n({success:!1,error:"Failed to load screenshot for color picking"})},a.src=c,e.n=4;break;case 3:e.p=3,e.v,n({success:!1,error:"Failed to capture screenshot for color picking"});case 4:e.n=6;break;case 5:e.p=5,i=e.v,n({success:!1,error:i.message});case 6:return e.a(2)}},e,null,[[1,3],[0,5]])}))).apply(this,arguments)}function v(e,r){try{var t=document.getElementById("result-overlay");if(t&&t.remove(),!document.getElementById("overlay-styles")){var n=document.createElement("link");n.id="overlay-styles",n.rel="stylesheet",n.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(n)}var o=document.createElement("div");o.id="result-overlay";var c=document.createElement("div");c.className="result-overlay-content";var a=document.createElement("div");a.className="color-preview-box-container";var i=document.createElement("div");i.className="color-preview-box",i.style.backgroundColor=e.lighter,a.appendChild(i),i.addEventListener("click",function(){browser.runtime.sendMessage({action:"ShowResultOverlay",tabId:r,color:e.lighter})});var u=document.createElement("div");u.className="color-preview-box-selected",u.style.backgroundColor=e.hex,a.appendChild(u),u.addEventListener("click",function(){navigator.clipboard.writeText(e.hex)});var s=document.createElement("div");s.className="color-preview-box",s.style.backgroundColor=e.darker,a.appendChild(s),s.addEventListener("click",function(){browser.runtime.sendMessage({action:"ShowResultOverlay",tabId:r,color:e.darker})}),c.appendChild(a);var l=document.createElement("p");l.className="color-hex",l.textContent=e.hex,c.appendChild(l);var d=document.createElement("p");d.className="color-rgb",d.textContent=e.rgb,c.appendChild(d);var p=function(e){"Escape"===e.key&&(o.remove(),document.removeEventListener("keydown",p))};document.addEventListener("keydown",p),o.addEventListener("click",function(e){o.remove()}),c.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),o.appendChild(c),document.body.appendChild(o)}catch(e){console.error("Result overlay injection error:",e)}}function m(){return(m=i(o().m(function e(r,n){var c,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,c="string"==typeof n?s(n):n){e.n=1;break}return console.error("Invalid color format:",n),e.a(2);case 1:return a=t(t({},c),{},{lighter:d(c).rgb,darker:p(c).rgb}),e.n=2,browser.tabs.executeScript(r,{code:"(".concat(v.toString(),")(").concat(JSON.stringify(a),", ").concat(JSON.stringify(r),")")});case 2:e.n=4;break;case 3:e.p=3,i=e.v,console.error("Error injecting result overlay:",i);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function y(){try{var e=document.getElementById("color-picker-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var r=document.createElement("link");r.id="overlay-styles",r.rel="stylesheet",r.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(r)}var t=document.createElement("div");t.id="color-picker-overlay",t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var r={x:e.clientX,y:e.clientY};t.remove(),browser.runtime.sendMessage({action:"getPixelColor",coordinates:r}).then(function(e){e&&e.success&&browser.runtime.sendMessage({action:"ShowResultOverlay",color:e.data})}).catch(function(e){console.error("Error getting pixel color:",e)})});var n=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(t)}catch(e){console.error("Overlay injection error:",e)}}function b(e,r){return h.apply(this,arguments)}function h(){return(h=i(o().m(function e(r,t){var n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r){e.n=1;break}return t({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.n=2,browser.tabs.executeScript(r,{code:"(".concat(y.toString(),")();")});case 2:t({success:!0}),e.n=4;break;case 3:e.p=3,n=e.v,console.error("Error starting color picker:",n),t({success:!1,error:n.message});case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}browser.runtime.onMessage.addListener(function(e,r,t){return"getPixelColor"===e.action?(function(e,r,t){f.apply(this,arguments)}(r.tab.id,e.coordinates,t),!0):"startColorPicking"===e.action?(b(e.tabId,t),!0):"ShowResultOverlay"===e.action?(function(e,r){m.apply(this,arguments)}(e.tabId,e.color),!0):(t({success:!1,error:"Unknown action: "+e.action}),!1)}),browser.commands.onCommand.addListener(function(e){"startColorPicking"===e&&browser.tabs.query({active:!0,currentWindow:!0}).then(function(e){e[0]&&b(e[0].id,function(e){console.log("Color picker started via keyboard shortcut:",e)})})})})();