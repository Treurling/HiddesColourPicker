/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(){var t,n,o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function i(e,o,c,a){var i=o&&o.prototype instanceof l?o:l,u=Object.create(i.prototype);return r(u,"_invoke",function(e,r,o){var c,a,i,l=0,u=o||[],d=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,r){return c=e,a=0,i=t,p.n=r,s}};function v(e,r){for(a=e,i=r,n=0;!d&&l&&!o&&n<u.length;n++){var o,c=u[n],v=p.p,f=c[2];e>3?(o=f===r)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=t):c[0]<=v&&((o=e<2&&v<c[1])?(a=0,p.v=r,p.n=c[1]):v<f&&(o=e<3||c[0]>r||r>f)&&(c[4]=e,c[5]=r,p.n=f,a=0))}if(o||e>1)return s;throw d=!0,r}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&v(u,f),a=u,i=f;(n=a<2?t:i)||!d;){c||(a?a<3?(a>1&&(p.n=-1),v(a,i)):p.n=i:p.v=i);try{if(l=2,c){if(a||(o="next"),n=c[o]){if(!(n=n.call(c,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,a<2&&(a=0)}else 1===a&&(n=c.return)&&n.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=t}else if((n=(d=p.n<0)?i:e.call(r,p))!==s)break}catch(e){c=t,a=1,i=e}finally{l=1}}return{value:n,done:d}}}(e,c,a),!0),u}var s={};function l(){}function u(){}function d(){}n=Object.getPrototypeOf;var p=[][c]?n(n([][c]())):(r(n={},c,function(){return this}),n),v=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e}return u.prototype=d,r(v,"constructor",d),r(d,"constructor",u),u.displayName="GeneratorFunction",r(d,a,"GeneratorFunction"),r(v),r(v,a,"Generator"),r(v,c,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:f}})()}function r(e,t,n,o){var c=Object.defineProperty;try{c({},"",{})}catch(e){c=0}r=function(e,t,n,o){function a(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?c?c(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},r(e,t,n,o)}function t(e,r,t,n,o,c,a){try{var i=e[c](a),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function n(e){return function(){var r=this,n=arguments;return new Promise(function(o,c){var a=e.apply(r,n);function i(e){t(a,o,c,i,s,"next",e)}function s(e){t(a,o,c,i,s,"throw",e)}i(void 0)})}}function o(){return(o=n(e().m(function r(t,n,o){var c,a,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return o({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.p=1,e.n=2,browser.tabs.captureVisibleTab(null,{format:"png",quality:100});case 2:c=e.v,(a=new Image).onload=function(){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=a.width,e.height=a.height,r.drawImage(a,0,0);var t=r.getImageData(n.x,n.y,1,1).data,c={r:t[0],g:t[1],b:t[2],a:t[3],hex:"#".concat(t[0].toString(16).padStart(2,"0")).concat(t[1].toString(16).padStart(2,"0")).concat(t[2].toString(16).padStart(2,"0")),rgb:"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")};o({success:!0,data:c})},a.onerror=function(){o({success:!1,error:"Failed to load screenshot for color picking"})},a.src=c,e.n=4;break;case 3:e.p=3,e.v,o({success:!1,error:"Failed to capture screenshot for color picking"});case 4:e.n=6;break;case 5:e.p=5,i=e.v,o({success:!1,error:i.message});case 6:return e.a(2)}},r,null,[[1,3],[0,5]])}))).apply(this,arguments)}function c(){try{var e=document.getElementById("result-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var r=document.createElement("link");r.id="overlay-styles",r.rel="stylesheet",r.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(r)}var t=document.createElement("div");t.id="result-overlay",t.innerHTML='\n            <div class="result-overlay-content">\n                <div class="color-preview-box-container">\n                    <div class="color-preview-box" style="background: color.lighter;"></div>\n                    <div class="color-preview-box-selected" style="background: color.hex;"></div>\n                    <div class="color-preview-box" style="background: color.darker;"></div>\n                </div>\n                <p class="color-hex">color.hex</p>\n                <p class="color-rgb">color.rgb</p>\n            </div>\n        ';var n=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(t)}catch(e){console.error("Result overlay injection error:",e)}}function a(e){var r="rgb("+e.rgb.replace("rgb(","").replace(")","").split(",").map(Number).map(function(e){return Math.min(Math.round(1.2*e),255)}).join(",")+")",t="rgb("+e.rgb.replace("rgb(","").replace(")","").split(",").map(Number).map(function(e){return Math.max(Math.round(.8*e),0)}).join(",")+")";return"(".concat(c.toString(),")()").replaceAll("color.hex",e.hex).replaceAll("color.rgb",e.rgb).replaceAll("color.lighter",r).replaceAll("color.darker",t)}function i(){return(i=n(e().m(function r(t,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,browser.tabs.executeScript(t,{code:a(n)});case 1:e.n=3;break;case 2:e.p=2,o=e.v,console.error("Error injecting result overlay:",o);case 3:return e.a(2)}},r,null,[[0,2]])}))).apply(this,arguments)}function s(){try{var e=document.getElementById("color-picker-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var r=document.createElement("link");r.id="overlay-styles",r.rel="stylesheet",r.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(r)}var t=document.createElement("div");t.id="color-picker-overlay",t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var r={x:e.clientX,y:e.clientY};t.remove(),browser.runtime.sendMessage({action:"getPixelColor",coordinates:r}).then(function(e){e&&e.success&&browser.runtime.sendMessage({action:"ShowResultOverlay",color:e.data})}).catch(function(e){console.error("Error getting pixel color:",e)})});var n=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(t)}catch(e){console.error("Overlay injection error:",e)}}function l(e,r){return u.apply(this,arguments)}function u(){return(u=n(e().m(function r(t,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return n({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.n=2,browser.tabs.executeScript(t,{code:"(".concat(s.toString(),")();")});case 2:n({success:!0}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error starting color picker:",o),n({success:!1,error:o.message});case 4:return e.a(2)}},r,null,[[0,3]])}))).apply(this,arguments)}browser.runtime.onMessage.addListener(function(e,r,t){return"getPixelColor"===e.action?(function(e,r,t){o.apply(this,arguments)}(r.tab.id,e.coordinates,t),!0):"startColorPicking"===e.action?(l(e.tabId,t),!0):"ShowResultOverlay"===e.action?(function(e,r){i.apply(this,arguments)}(e.tabId,e.color),!0):(t({success:!1,error:"Unknown action: "+e.action}),!1)}),browser.commands.onCommand.addListener(function(e){"startColorPicking"===e&&browser.tabs.query({active:!0,currentWindow:!0}).then(function(e){e[0]&&l(e[0].id,function(e){console.log("Color picker started via keyboard shortcut:",e)})})})})();