/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(){var r,n,o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function i(e,o,c,a){var i=o&&o.prototype instanceof s?o:s,l=Object.create(i.prototype);return t(l,"_invoke",function(e,t,o){var c,a,i,s=0,l=o||[],p=!1,d={p:0,n:0,v:r,a:f,f:f.bind(r,4),d:function(e,t){return c=e,a=0,i=r,d.n=t,u}};function f(e,t){for(a=e,i=t,n=0;!p&&s&&!o&&n<l.length;n++){var o,c=l[n],f=d.p,v=c[2];e>3?(o=v===t)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=r):c[0]<=f&&((o=e<2&&f<c[1])?(a=0,d.v=t,d.n=c[1]):f<v&&(o=e<3||c[0]>t||t>v)&&(c[4]=e,c[5]=t,d.n=v,a=0))}if(o||e>1)return u;throw p=!0,t}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&f(l,v),a=l,i=v;(n=a<2?r:i)||!p;){c||(a?a<3?(a>1&&(d.n=-1),f(a,i)):d.n=i:d.v=i);try{if(s=2,c){if(a||(o="next"),n=c[o]){if(!(n=n.call(c,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,a<2&&(a=0)}else 1===a&&(n=c.return)&&n.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=r}else if((n=(p=d.n<0)?i:e.call(t,d))!==u)break}catch(e){c=r,a=1,i=e}finally{s=1}}return{value:n,done:p}}}(e,c,a),!0),l}var u={};function s(){}function l(){}function p(){}n=Object.getPrototypeOf;var d=[][c]?n(n([][c]())):(t(n={},c,function(){return this}),n),f=p.prototype=s.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,t(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=p,t(f,"constructor",p),t(p,"constructor",l),l.displayName="GeneratorFunction",t(p,a,"GeneratorFunction"),t(f),t(f,a,"Generator"),t(f,c,function(){return this}),t(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:v}})()}function t(e,r,n,o){var c=Object.defineProperty;try{c({},"",{})}catch(e){c=0}t=function(e,r,n,o){function a(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?c?c(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},t(e,r,n,o)}function r(e,t,r,n,o,c,a){try{var i=e[c](a),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(o,c){var a=e.apply(t,n);function i(e){r(a,o,c,i,u,"next",e)}function u(e){r(a,o,c,i,u,"throw",e)}i(void 0)})}}function o(){return(o=n(e().m(function t(r,n,o){var c,a,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r){e.n=1;break}return o({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.p=1,e.n=2,browser.tabs.captureVisibleTab(null,{format:"png",quality:100});case 2:c=e.v,(a=new Image).onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0);var r=t.getImageData(n.x,n.y,1,1).data,c={r:r[0],g:r[1],b:r[2],a:r[3],hex:"#".concat(r[0].toString(16).padStart(2,"0")).concat(r[1].toString(16).padStart(2,"0")).concat(r[2].toString(16).padStart(2,"0")),rgb:"rgb(".concat(r[0],", ").concat(r[1],", ").concat(r[2],")")};o({success:!0,data:c})},a.onerror=function(){o({success:!1,error:"Failed to load screenshot for color picking"})},a.src=c,e.n=4;break;case 3:e.p=3,e.v,o({success:!1,error:"Failed to capture screenshot for color picking"});case 4:e.n=6;break;case 5:e.p=5,i=e.v,o({success:!1,error:i.message});case 6:return e.a(2)}},t,null,[[1,3],[0,5]])}))).apply(this,arguments)}function c(){try{var e=document.getElementById("color-picker-overlay");e&&e.remove();var t=document.createElement("div");t.id="color-picker-overlay",t.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: transparent; cursor: crosshair; z-index: 999999; pointer-events: auto;",t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new CustomEvent("ColorPicked",{detail:{x:e.clientX,y:e.clientY}})),t.remove()});var r=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),document.body.appendChild(t)}catch(e){console.error("Overlay injection error:",e)}}function a(){return(a=n(e().m(function t(r,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r){e.n=1;break}return n({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.n=2,browser.tabs.executeScript(r,{code:"(".concat(c.toString(),")();")});case 2:n({success:!0}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error starting color picker:",o),n({success:!1,error:o.message});case 4:return e.a(2)}},t,null,[[0,3]])}))).apply(this,arguments)}function i(){try{var e=document.getElementById("result-overlay");e&&e.remove();var t=document.createElement("div");t.id="result-overlay",t.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999999; pointer-events: auto;",t.innerHTML='\n            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: color.hex; color: white; padding: 10px; border-radius: 5px;">\n                <p>Color: color.hex</p>\n                <p>RGB: color.rgb</p>\n            </div>\n        ';var r=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),document.body.appendChild(t)}catch(e){console.error("Result overlay injection error:",e)}}function u(e){return"(".concat(i.toString(),")()").replaceAll("color.hex",e.hex).replaceAll("color.rgb",e.rgb)}function s(){return(s=n(e().m(function t(r,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,browser.tabs.executeScript(r,{code:u(n)});case 1:e.n=3;break;case 2:e.p=2,o=e.v,console.error("Error injecting result overlay:",o);case 3:return e.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}browser.runtime.onMessage.addListener(function(e,t,r){return"getPixelColor"===e.action?(function(e,t,r){o.apply(this,arguments)}(t.tab.id,e.coordinates,r),!0):"startColorPicking"===e.action?(function(e,t){a.apply(this,arguments)}(e.tabId,r),!0):"ShowResultOverlay"===e.action?(function(e,t){s.apply(this,arguments)}(e.tabId,e.color),!0):(r({success:!1,error:"Unknown action: "+e.action}),!1)})})();