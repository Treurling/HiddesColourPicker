/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(){var t,n,o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function i(e,o,c,a){var i=o&&o.prototype instanceof u?o:u,l=Object.create(i.prototype);return r(l,"_invoke",function(e,r,o){var c,a,i,u=0,l=o||[],d=!1,v={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return c=e,a=0,i=t,v.n=r,s}};function p(e,r){for(a=e,i=r,n=0;!d&&u&&!o&&n<l.length;n++){var o,c=l[n],p=v.p,f=c[2];e>3?(o=f===r)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=t):c[0]<=p&&((o=e<2&&p<c[1])?(a=0,v.v=r,v.n=c[1]):p<f&&(o=e<3||c[0]>r||r>f)&&(c[4]=e,c[5]=r,v.n=f,a=0))}if(o||e>1)return s;throw d=!0,r}return function(o,l,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,f),a=l,i=f;(n=a<2?t:i)||!d;){c||(a?a<3?(a>1&&(v.n=-1),p(a,i)):v.n=i:v.v=i);try{if(u=2,c){if(a||(o="next"),n=c[o]){if(!(n=n.call(c,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,a<2&&(a=0)}else 1===a&&(n=c.return)&&n.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=t}else if((n=(d=v.n<0)?i:e.call(r,v))!==s)break}catch(e){c=t,a=1,i=e}finally{u=1}}return{value:n,done:d}}}(e,c,a),!0),l}var s={};function u(){}function l(){}function d(){}n=Object.getPrototypeOf;var v=[][c]?n(n([][c]())):(r(n={},c,function(){return this}),n),p=d.prototype=u.prototype=Object.create(v);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,r(p,"constructor",d),r(d,"constructor",l),l.displayName="GeneratorFunction",r(d,a,"GeneratorFunction"),r(p),r(p,a,"Generator"),r(p,c,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:f}})()}function r(e,t,n,o){var c=Object.defineProperty;try{c({},"",{})}catch(e){c=0}r=function(e,t,n,o){function a(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?c?c(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},r(e,t,n,o)}function t(e,r,t,n,o,c,a){try{var i=e[c](a),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function n(e){return function(){var r=this,n=arguments;return new Promise(function(o,c){var a=e.apply(r,n);function i(e){t(a,o,c,i,s,"next",e)}function s(e){t(a,o,c,i,s,"throw",e)}i(void 0)})}}function o(e,r,t){return"#"+((1<<24)+(e<<16)+(r<<8)+t).toString(16).slice(1)}function c(e,r,t,n){return{r:e,g:r,b:t,a:n,hex:o(e,r,t),rgb:"rgb(".concat(e,", ").concat(r,", ").concat(t,")")}}function a(){return(a=n(e().m(function r(t,n,o){var a,i,s;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return o({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.p=1,e.n=2,browser.tabs.captureVisibleTab(null,{format:"png",quality:100});case 2:a=e.v,(i=new Image).onload=function(){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=i.width,e.height=i.height,r.drawImage(i,0,0);var t=r.getImageData(n.x,n.y,1,1).data,a=c(t[0],t[1],t[2],t[3]);o({success:!0,data:a})},i.onerror=function(){o({success:!1,error:"Failed to load screenshot for color picking"})},i.src=a,e.n=4;break;case 3:e.p=3,e.v,o({success:!1,error:"Failed to capture screenshot for color picking"});case 4:e.n=6;break;case 5:e.p=5,s=e.v,o({success:!1,error:s.message});case 6:return e.a(2)}},r,null,[[1,3],[0,5]])}))).apply(this,arguments)}function i(){try{var e=document.getElementById("result-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var r=document.createElement("link");r.id="overlay-styles",r.rel="stylesheet",r.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(r)}var t=document.createElement("div");t.id="result-overlay";var n=document.createElement("div");n.className="result-overlay-content",n.innerHTML='\n            <div class="color-preview-box-container">\n                <div class="color-preview-box" style="background: color.lighter;"></div>\n                <div class="color-preview-box-selected" style="background: color.hex;"></div>\n                <div class="color-preview-box" style="background: color.darker;"></div>\n            </div>\n            <p class="color-hex">color.hex</p>\n            <p class="color-rgb">color.rgb</p>\n        ';var o=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o),t.addEventListener("click",function(e){t.remove()}),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),t.appendChild(n),document.body.appendChild(t)}catch(e){console.error("Result overlay injection error:",e)}}function s(e){return"(".concat(i.toString(),")()").replaceAll("color.hex",e.hex).replaceAll("color.rgb",e.rgb).replaceAll("color.lighter",function(e){return c(Math.min(Math.round(1.2*e.r),255),Math.min(Math.round(1.2*e.g),255),Math.min(Math.round(1.2*e.b),255),e.a)}(e).rgb).replaceAll("color.darker",function(e){return c(Math.max(Math.round(.8*e.r),0),Math.max(Math.round(.8*e.g),0),Math.max(Math.round(.8*e.b),0),e.a)}(e).rgb)}function u(){return(u=n(e().m(function r(t,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,browser.tabs.executeScript(t,{code:s(n)});case 1:e.n=3;break;case 2:e.p=2,o=e.v,console.error("Error injecting result overlay:",o);case 3:return e.a(2)}},r,null,[[0,2]])}))).apply(this,arguments)}function l(){try{var e=document.getElementById("color-picker-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var r=document.createElement("link");r.id="overlay-styles",r.rel="stylesheet",r.href=browser.runtime.getURL("overlay.css"),document.head.appendChild(r)}var t=document.createElement("div");t.id="color-picker-overlay",t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var r={x:e.clientX,y:e.clientY};t.remove(),browser.runtime.sendMessage({action:"getPixelColor",coordinates:r}).then(function(e){e&&e.success&&browser.runtime.sendMessage({action:"ShowResultOverlay",color:e.data})}).catch(function(e){console.error("Error getting pixel color:",e)})});var n=function(e){"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(t)}catch(e){console.error("Overlay injection error:",e)}}function d(e,r){return v.apply(this,arguments)}function v(){return(v=n(e().m(function r(t,n){var o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return n({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.n=2,browser.tabs.executeScript(t,{code:"(".concat(l.toString(),")();")});case 2:n({success:!0}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error starting color picker:",o),n({success:!1,error:o.message});case 4:return e.a(2)}},r,null,[[0,3]])}))).apply(this,arguments)}browser.runtime.onMessage.addListener(function(e,r,t){return"getPixelColor"===e.action?(function(e,r,t){a.apply(this,arguments)}(r.tab.id,e.coordinates,t),!0):"startColorPicking"===e.action?(d(e.tabId,t),!0):"ShowResultOverlay"===e.action?(function(e,r){u.apply(this,arguments)}(e.tabId,e.color),!0):(t({success:!1,error:"Unknown action: "+e.action}),!1)}),browser.commands.onCommand.addListener(function(e){"startColorPicking"===e&&browser.tabs.query({active:!0,currentWindow:!0}).then(function(e){e[0]&&d(e[0].id,function(e){console.log("Color picker started via keyboard shortcut:",e)})})})})();