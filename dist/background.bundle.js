/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function n(t,r,n){return(r=function(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function o(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,o,a){var i=n&&n.prototype instanceof u?n:u,l=Object.create(i.prototype);return c(l,"_invoke",function(r,n,o){var c,a,i,u=0,l=o||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return c=t,a=0,i=e,p.n=r,s}};function f(r,n){for(a=r,i=n,t=0;!d&&u&&!o&&t<l.length;t++){var o,c=l[t],f=p.p,v=c[2];r>3?(o=v===n)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=e):c[0]<=f&&((o=r<2&&f<c[1])?(a=0,p.v=n,p.n=c[1]):f<v&&(o=r<3||c[0]>n||n>v)&&(c[4]=r,c[5]=n,p.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),a=l,i=v;(t=a<2?e:i)||!d;){c||(a?a<3?(a>1&&(p.n=-1),f(a,i)):p.n=i:p.v=i);try{if(u=2,c){if(a||(o="next"),t=c[o]){if(!(t=t.call(c,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,a<2&&(a=0)}else 1===a&&(t=c.return)&&t.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=e}else if((t=(d=p.n<0)?i:r.call(n,p))!==s)break}catch(t){c=e,a=1,i=t}finally{u=1}}return{value:t,done:d}}}(r,o,a),!0),l}var s={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,c(f,"constructor",d),c(d,"constructor",l),l.displayName="GeneratorFunction",c(d,a,"GeneratorFunction"),c(f),c(f,a,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:v}})()}function c(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},c(e,t,r,n)}function a(e,t,r,n,o,c,a){try{var i=e[c](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){a(c,n,o,i,s,"next",e)}function s(e){a(c,n,o,i,s,"throw",e)}i(void 0)})}}function s(e,t,r){return"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1)}function u(e){var t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);return t?{r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:255,hex:s(parseInt(t[1]),parseInt(t[2]),parseInt(t[3])),rgb:e}:null}function l(e,t,r,n){return{r:e,g:t,b:r,a:n,hex:s(e,t,r),rgb:"rgb(".concat(e,", ").concat(t,", ").concat(r,")")}}function d(e){return l(Math.min(Math.round(1.2*e.r),255),Math.min(Math.round(1.2*e.g),255),Math.min(Math.round(1.2*e.b),255),e.a)}function p(e){return l(Math.max(Math.round(.8*e.r),0),Math.max(Math.round(.8*e.g),0),Math.max(Math.round(.8*e.b),0),e.a)}function f(){return(f=i(o().m(function e(t,r,n){var c,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return n({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.p=1,e.n=2,browser.tabs.captureVisibleTab(null,{format:"png",quality:100});case 2:c=e.v,(a=new Image).onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0);var o=t.getImageData(r.x,r.y,1,1).data,c=l(o[0],o[1],o[2],o[3]);n({success:!0,data:c})},a.onerror=function(){n({success:!1,error:"Failed to load screenshot for color picking"})},a.src=c,e.n=4;break;case 3:e.p=3,e.v,n({success:!1,error:"Failed to capture screenshot for color picking"});case 4:e.n=6;break;case 5:e.p=5,i=e.v,n({success:!1,error:i.message});case 6:return e.a(2)}},e,null,[[1,3],[0,5]])}))).apply(this,arguments)}function v(e,t){try{var r=document.getElementById("result-overlay");if(r&&r.remove(),!document.getElementById("overlay-styles")){var n=document.createElement("link");n.id="overlay-styles",n.rel="stylesheet",n.href=browser.runtime.getURL("overlay.css")+"?v="+Date.now(),document.head.appendChild(n)}var o=document.createElement("div");o.id="result-overlay";var c=document.createElement("div");c.className="result-overlay-content";var a=document.createElement("div");a.className="color-preview-box-container";var i=document.createElement("div");i.className="color-preview-box",i.style.backgroundColor=e.lighter.rgb,i.innerHTML='<span class="tooltip-text">'.concat(e.lighter.hex,"</span>"),a.appendChild(i),i.addEventListener("click",function(){browser.runtime.sendMessage({action:"ShowResultOverlay",tabId:t,color:e.lighter.rgb})});var s=document.createElement("div");s.className="color-preview-box-selected",s.style.backgroundColor=e.hex,s.innerHTML='<span class="tooltip-text">copy to clipboard</span>',a.appendChild(s),s.addEventListener("click",function(){navigator.clipboard.writeText(e.hex),s.innerHTML='<span class="tooltip-text">copied to clipboard!</span>'});var u=document.createElement("div");u.className="color-preview-box",u.style.backgroundColor=e.darker.rgb,u.innerHTML='<span class="tooltip-text">'.concat(e.darker.hex,"</span>"),a.appendChild(u),u.addEventListener("click",function(){browser.runtime.sendMessage({action:"ShowResultOverlay",tabId:t,color:e.darker.rgb})}),c.appendChild(a);var l=document.createElement("p");l.className="color-hex",l.textContent=e.hex,c.appendChild(l);var d=document.createElement("p");d.className="color-rgb",d.textContent=e.rgb,c.appendChild(d);var p=function(e){"Escape"===e.key&&(o.remove(),document.removeEventListener("keydown",p))};document.addEventListener("keydown",p),o.addEventListener("click",function(e){o.remove()}),c.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),o.appendChild(c),document.body.appendChild(o)}catch(e){console.error("Result overlay injection error:",e)}}function m(){return(m=i(o().m(function e(t,n){var c,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,c="string"==typeof n?u(n):n){e.n=1;break}return console.error("Invalid color format:",n),e.a(2);case 1:return a=r(r({},c),{},{lighter:d(c),darker:p(c)}),e.n=2,browser.tabs.executeScript(t,{code:"(".concat(v.toString(),")(").concat(JSON.stringify(a),", ").concat(JSON.stringify(t),")")});case 2:e.n=4;break;case 3:e.p=3,i=e.v,console.error("Error injecting result overlay:",i);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function y(){try{var e=document.getElementById("color-picker-overlay");if(e&&e.remove(),!document.getElementById("overlay-styles")){var t=document.createElement("link");t.id="overlay-styles",t.rel="stylesheet",t.href=browser.runtime.getURL("overlay.css")+"?v="+Date.now(),document.head.appendChild(t)}var r=document.createElement("div");r.id="color-picker-overlay",r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t={x:e.clientX,y:e.clientY};r.remove(),browser.runtime.sendMessage({action:"getPixelColor",coordinates:t}).then(function(e){e&&e.success&&browser.runtime.sendMessage({action:"ShowResultOverlay",color:e.data})}).catch(function(e){console.error("Error getting pixel color:",e)})});var n=function(e){"Escape"===e.key&&(r.remove(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(r)}catch(e){console.error("Overlay injection error:",e)}}function b(e,t){return h.apply(this,arguments)}function h(){return(h=i(o().m(function e(t,r){var n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t){e.n=1;break}return r({success:!1,error:"No tab ID provided"}),e.a(2);case 1:return e.n=2,browser.tabs.executeScript(t,{code:"(".concat(y.toString(),")();")});case 2:r({success:!0}),e.n=4;break;case 3:e.p=3,n=e.v,console.error("Error starting color picker:",n),r({success:!1,error:n.message});case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}browser.runtime.onMessage.addListener(function(e,t,r){return"getPixelColor"===e.action?(function(e,t,r){f.apply(this,arguments)}(t.tab.id,e.coordinates,r),!0):"startColorPicking"===e.action?(b(e.tabId,r),!0):"ShowResultOverlay"===e.action?(function(e,t){m.apply(this,arguments)}(e.tabId,e.color),!0):(r({success:!1,error:"Unknown action: "+e.action}),!1)}),browser.commands.onCommand.addListener(function(e){"startColorPicking"===e&&browser.tabs.query({active:!0,currentWindow:!0}).then(function(e){e[0]&&b(e[0].id,function(e){console.log("Color picker started via keyboard shortcut:",e)})})})})();